=haml :game_info
- if @current_user
  - if @pickset = @season.picksets.find_by(game: @game)
    - @picks = @pickset.performance_ids.map(&:to_s)
    - total = @pickset.total
    - perfs = @pickset.performances.sort_by(&:price).reverse + @game.performances.order_by(price: :desc).nin(_id: @pickset.performance_ids)
    %p= "Picks last updated at #{@pickset.updated_at}"
    %p= "Total cost: #{@pickset.cost}"
    %p= "Total points (tiebreaker): #{@pickset.total}"
  - else
    - @pickset ||= Pickset.new
    - @picks = []
    - total = 0
    - perfs = @game.performances.order_by(price: :desc)
  - if @game.open?
    %form{method: "post"}
      %input{ type: 'number', name: 'total', value: total } Total points
      %br
      - if @picks.empty?
        %input.btn.btn-success{ type: 'submit', value: 'Make Picks' }
      - else
        %input.btn.btn-warning{ type: 'submit', value: 'Update Picks' }
      %table.table.table-condensed
        %thead
          %th Number
          %th Last Name
          %th First Name
          %th Price
          %th Select
        %tbody
          - perfs.each do |perf|
            %tr{class: ('info' if @picks.include?(perf._id.to_s))}
              - p = perf.player
              %td= p.number
              %td= p.last
              %td= p.first
              %td= perf.price
              %td
                %input{type: :checkbox, name: 'picks[]', value: perf._id, checked: @picks.include?(perf._id.to_s)}
          %br
          %br
  - elsif @game.status_code.between?(5,7)
    %p Game is locked. You selected the following players:
    %ul
      - @pickset.performances.each do |perf|
        %li= "#{perf.player.first} #{perf.player.last}"
  - elsif @game.status_code == 8
    %p= "Total points: #{@pickset.points}"
    %p= "Rank: #{@pickset.rank}"
    %p= "Rank points: #{@pickset.rank_points}"
    %table.table.table-bordered.table-striped.table-condensed
      %thead
        %th Rank
        %th Poster
        %th Points
        %th Tiebreaker
        %th Cost
      %tbody
        - @game.rankings.each do |pick|
          %tr
            %td= pick.rank
            %td= pick.season.user.name
            %td= pick.points
            %td= pick.difference
            %td= pick.cost
